paths:
  /api/log-sources:
    get:
      summary: 'Get a list of log sources'
      operationId: 'log-source-get-all'
      description: |
        This endpoint gets a list of log sources from the workspace.
        The list of log sources may include multiple versions of each log source.
      tags:
        - 'Log Sources'
      parameters:
        - name: limit
          in: query
          description: |
            The number of log sources to retrieve.
            The default (0) will retrieve all log sources.
          schema:
            type: number
            default: 0
        - name: offset
          in: query
          description: |
            The number of log sources to skip.
            The default (0) will start with the first log source.
          schema:
            type: number
            default: 0
        - name: domain
          in: query
          description: |
            Only retrieve objects that contain the specified domain in their `x_mitre_domains` array.
            This parameter may be set multiple times to retrieve objects with any of the provided domains.
          schema:
            oneOf:
              - type: string
              - type: array
                items:
                  type: string
          example: 'mobile-attack'
        - name: state
          in: query
          description: |
            State of the object in the editing workflow.
            If this parameter is not set, objects will be retrieved regardless of state.
            This parameter may be set multiple times to retrieve objects with any of the provided states.
          schema:
            oneOf:
              - type: string
              - type: array
                items:
                  type: string
          example: 'work-in-progress'
        - name: includeRevoked
          in: query
          description: |
            Whether to include objects that have the `revoked` property set to true.
          schema:
            type: boolean
            default: false
        - name: includeDeprecated
          in: query
          description: |
            Whether to include objects that have the `x_mitre_deprecated` property set to true.
          schema:
            type: boolean
            default: false
        - name: search
          in: query
          description: |
            Only return objects where the provided search text occurs in the `attack_id`, `name`, or `description`.
            The search is case-insensitive.
          schema:
            type: string
          allowReserved: true
          example: 'windows'
        - name: lastUpdatedBy
          in: query
          description: |
            The STIX ID of the user who last modified the object
          schema:
            oneOf:
              - type: string
              - type: array
                items:
                  type: string
          example: 'identity--f568ad89-69bc-48e7-877b-43755f1d376d'
        - name: includePagination
          in: query
          description: |
            Whether to include pagination data in the returned value.
            Wraps returned objects in a larger object.
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: 'A list of log sources.'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../components/log-sources.yml#/components/schemas/log-source'

    post:
      summary: 'Create a log source'
      operationId: 'log-source-create'
      description: |
        This endpoint creates a new log source in the workspace.
        If the `stix.id` property is set, it creates a new version of an existing log source.
        If the `stix.id` property is not set, it creates a new log source, generating a STIX id for it.
      tags:
        - 'Log Sources'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../components/log-sources.yml#/components/schemas/log-source'
      responses:
        '201':
          description: 'The log source has been successfully created.'
          content:
            application/json:
              schema:
                $ref: '../components/log-sources.yml#/components/schemas/log-source'
        '400':
          description: 'Missing or invalid parameters were provided. The log source was not created.'
        '409':
          description: 'Duplicate `stix.id` and `stix.modified` properties. The log source was not created.'

  /api/log-sources/{stixId}:
    get:
      summary: 'Get one or more versions of a log source'
      operationId: 'log-source-get-one-id'
      description: |
        This endpoint gets a list of one or more versions of a log source from the workspace, identified by their STIX id.
      tags:
        - 'Log Sources'
      parameters:
        - name: stixId
          in: path
          description: 'STIX id of the log source to retrieve'
          required: true
          schema:
            type: string
        - name: versions
          in: query
          description: |
            The versions of the log source to retrieve.
            `all` gets all versions of the log source, `latest` gets only the latest version.
          schema:
            type: string
            enum:
              - all
              - latest
            default: latest
      responses:
        '200':
          description: 'A list of log sources matching the requested STIX id.'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../components/log-sources.yml#/components/schemas/log-source'
        '404':
          description: 'A log source with the requested STIX id was not found.'
    delete:
      summary: 'Delete a log source'
      operationId: 'log-source-delete-all'
      description: |
        This endpoint deletes all versions of a log source from the workspace.
        The log source is identified by its STIX id.
      tags:
        - 'Log Sources'
      parameters:
        - name: stixId
          in: path
          description: 'STIX id of the log source to delete'
          required: true
          schema:
            type: string
      responses:
        '204':
          description: 'All the log source versions were successfully deleted.'
        '404':
          description: 'A log source with the requested STIX id was not found.'

  /api/log-sources/{stixId}/permutations:
    get:
      summary: 'Gets the permutations associated with the latest version of a log source'
      operationId: 'log-source-get-one-id-permutations'
      description: |
        This endpoint gets a list of permutations associated with the latest version of a log source, identified by its STIX id.
      tags:
        - 'Log Sources'
      parameters:
        - name: stixId
          in: path
          description: 'STIX id of the log source to retrieve'
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 'A list of permutations from the latest version of the log source matching the requested STIX id.'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../components/log-sources.yml#/components/schemas/x-mitre-log-source-permutation'
        '404':
          description: 'A log source with the requested STIX id was not found.'

  /api/log-sources/{stixId}/modified/{modified}:
    get:
      summary: 'Gets the version of a log source matching the STIX id and modified date'
      operationId: 'log-source-get-by-id-and-modified'
      description: |
        This endpoint gets a single version of a log source from the workspace, identified by its STIX id and modified date.
      tags:
        - 'Log Sources'
      parameters:
        - name: stixId
          in: path
          description: 'STIX id of the log source to retrieve'
          required: true
          schema:
            type: string
        - name: modified
          in: path
          description: 'modified date of the log source to retrieve'
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 'The version of a log source matching the STIX id and modified date.'
          content:
            application/json:
              schema:
                $ref: '../components/log-sources.yml#/components/schemas/log-source'
        '404':
          description: 'A log source with the requested STIX id and modified date was not found.'
    put:
      summary: 'Update a log source'
      operationId: 'log-source-update'
      description: |
        This endpoint updates a single version of a log source in the workspace, identified by its STIX id and modified date.
      tags:
        - 'Log Sources'
      parameters:
        - name: stixId
          in: path
          description: 'STIX id of the log source to update'
          required: true
          schema:
            type: string
        - name: modified
          in: path
          description: 'modified date of the log source to update'
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../components/log-sources.yml#/components/schemas/log-source'
      responses:
        '200':
          description: 'The log source was updated.'
          content:
            application/json:
              schema:
                $ref: '../components/log-sources.yml#/components/schemas/log-source'
        '400':
          description: 'Missing or invalid parameters were provided. The log source was not updated.'
        '404':
          description: 'A log source with the requested STIX id and modified date was not found.'
    delete:
      summary: 'Delete a log source'
      operationId: 'log-source-delete'
      description: |
        This endpoint deletes a single version of a log source from the workspace.
        The log source is identified by its STIX id and modified date.
      tags:
        - 'Log Sources'
      parameters:
        - name: stixId
          in: path
          description: 'STIX id of the log source to delete'
          required: true
          schema:
            type: string
        - name: modified
          in: path
          description: 'modified date of the log source to delete'
          required: true
          schema:
            type: string
      responses:
        '204':
          description: 'The log source was successfully deleted.'
        '404':
          description: 'A log source with the requested STIX id and modified date was not found.'
